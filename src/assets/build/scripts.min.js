$(document).ready(function(){$(".js-code-field").each(function(){var e=$(this),t=ace.edit(e.siblings(".js-code").get(0)),a=e.data("mode")||"html",n=e.data("theme")||"textmate";t.setTheme("ace/theme/"+n),t.getSession().setMode("ace/mode/"+a),t.getSession().setValue(e.val()),t.getSession().on("change",function(){e.val(t.getSession().getValue())})})}),$(document).ready(function(){$(".js-color-field").each(function(){var e=$(this),t=e.data("minicolors");t=$.extend({theme:"bootstrap"},t),e.minicolors(t)})}),$(function(){$(".js-datetimepicker").each(function(){var e=$(this).find("input"),t=e.data("datetime");$(this).datetimepicker(t)})}),$(document).ready(function(){$(".js-upload-image-container .upload-result").magnificPopup({type:"image"})}),$(".js-uploader-field").each(function(){var e=$(this),t=e.siblings(".js-upload-container");t.find("input:file").fileupload({dataType:"json",url:e.data("url")||"/upload",paramName:"file",formData:[{name:"type",value:e.data("type")||"default"}],done:function(a,n){var o=n.result;e.val(o.filename),t.find(".upload-result").attr("href",o.path),t.trigger("uploaded",[o])},fail:function(e,t){console.error(t)}})}),$(".js-upload-remove").on("click",function(e){e.preventDefault();var t=$(this).parents(".js-upload-container");t.siblings(".js-uploader-field").val(""),t.find(".upload-result").attr("href",""),t.trigger("removed",[t])}),$(".js-upload-image-container").on("uploaded",function(e,t){$(this).find(".upload-result img").attr("src",t.path)}).on("removed",function(){$(this).find(".upload-result img").attr("src","")}),$(".js-upload-file-container").on("uploaded",function(e,t){$(this).find(".upload-result").text(t.filename)}).on("removed",function(){$(this).find(".upload-result").text("")}),$(document).ready(function(){function e(e){return e?e.split(":"):null}$(".js-geopoint-field").each(function(){function t(e){o?o.setLatLng(e):(o=L.marker(e,{draggable:!0}).addTo(u),o.on("dragend",function(e){var a=this.getLatLng();t(a),i.val(a.lat+":"+a.lng)})),u.panTo(e)}function a(){o&&(u.removeLayer(o),o=null)}function n(e,t,a){var n=i.data("type")||a;return _.contains(t,n)||(console.warn(e+" doesnt support `"+n+"` type. Only "+t.join(" | ")+". Fallback to "+a),n=a),n}var o,i=$(this),l=$(this).siblings(".js-map"),r=i.data("layer")||"osm",s=_.defaults(i.data("map")||{},{center:[51.476852,-498e-6],zoom:12}),d=e(i.val());d&&(s.center=d);var u=new L.Map(l.get(0),s);d&&t(d);var c,p;switch(r){case"yandex":p=n("Yandex",["map","satellite","hybrid","publicMap","publicMapHybrid"],"publicMap"),c=new L.Yandex(p);break;case"osm":p=i.data("type")||"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",0!==p.indexOf("http")&&0!==p.indexOf("//")&&(console.warn("OSM doesnt support `"+p+"` type. Fallback to http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"),p="http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"),c=new L.TileLayer(p);break;case"google":p=n("Google",["ROADMAP","SATELLITE","HYBRID","TERRAIN"],"ROADMAP"),c=new L.Google("ROADMAP");break;case"bing":p=n("Bing",["Road","Aerial","AerialWithLabels","Birdseye","BirdseyeWithLabels"],"Road"),c=new L.BingLayer("AvoUren6Dm0PAAyhkqPcEQs3PtNsC_VHqb2Pxyac59fd-YME_3FZ_6No4BL5iEAe",{type:p});break;default:console.warn("Layer `"+r+"` doesn't supported, you should use one of yandex, google, osm or bing. Fallback to OSM layer"),c=new L.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png")}u.addLayer(c),i.on("change",function(){var n=i.val();if(n){var o=e(n);t(o)}else a()}),u.on("click",function(e){t(e.latlng),i.val(e.latlng.lat+":"+e.latlng.lng)})})}),$(".select2").each(function(){function e(e){e.select2({theme:"bootstrap"})}var t=$(this),a=t.val(),n=t.data("value"),o=t.data("ajax--url");if(o&&n&&!a){var i=$.ajax({url:o+"/init",data:{ids:n}});i.then(function(a){a.results.forEach(function(e){var a=$("<option>").text(e.text).attr("value",e.id).prop("selected",!0);t.prepend(a)}),e(t)})}else e(t)});